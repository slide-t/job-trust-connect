<script>
document.addEventListener("DOMContentLoaded",()=>{const qs=s=>document.querySelector(s),allSteps=document.querySelectorAll(".form-step"),prevBtn=qs("#prevBtn"),nextBtn=qs("#nextBtn"),previewBtn=qs("#previewBtn"),submitBtn=qs("#submitBtn"),spinner=qs("#spinner"),form=qs("#regForm");let currentStep=0;function showStep(n){allSteps.forEach((s,i)=>{s.style.display=i===n?"block":"none"}),prevBtn.style.display=n===0?"none":"inline-block",nextBtn.style.display=n===allSteps.length-1?"none":"inline-block",previewBtn.style.display=n===allSteps.length-1?"inline-block":"none",submitBtn.style.display=n===allSteps.length-1?"inline-block":"none"}function validateStep(n){let inputs=allSteps[n].querySelectorAll("input,select,textarea"),valid=!0;return inputs.forEach(inp=>{if(!inp.checkValidity()){inp.reportValidity(),valid=!1}}),valid}function nextPrev(n){if(n===1&&!validateStep(currentStep))return;currentStep+=n,currentStep>=allSteps.length&&(currentStep=allSteps.length-1),showStep(currentStep)}function startSpinner(btn){spinner.style.display="inline-block",btn.disabled=!0}function stopSpinner(btn){spinner.style.display="none",btn.disabled=!1}async function loadLGAs(){try{let res=await fetch("nigeria-lgas.json"),data=await res.json(),stateSel=qs("#stateOrigin"),lgaSel=qs("#lgaOrigin"),lgaCol=qs("#lgaCol");stateSel.innerHTML='<option value="">Select State</option>'+Object.keys(data).map(st=>`<option>${st}</option>`).join(""),stateSel.addEventListener("change",()=>{const st=stateSel.value;if(!st){lgaCol.style.display="none",lgaSel.innerHTML="";return}let lgas=data[st]||[];lgaSel.innerHTML='<option value="">Select LGA</option>'+lgas.map(l=>`<option>${l}</option>`).join(""),lgaCol.style.display="block"})}catch(e){console.error("Error loading LGAs:",e)}}function buildPreview(){let fd=new FormData(form),win=window.open("","_blank"),html="<h2>Registration Preview</h2><table border='1' cellpadding='5' cellspacing='0'>";fd.forEach((val,key)=>{html+=`<tr><td><b>${key}</b></td><td>${val}</td></tr>`}),html+="</table><button onclick='window.print()'>Print PDF</button>",win.document.write(html),win.document.close()}async function submitForm(){startSpinner(submitBtn);let fd=new FormData(form),payload={fullname:fd.get("fullname"),address:fd.get("address"),gender:fd.get("gender"),phoneNumber:fd.get("phoneNumber"),guarantorName:fd.get("guarantorName"),guarantorPhone:fd.get("guarantorPhone")};try{await fetch("https://sheetdb.io/api/v1/YOUR_SHEETDB_ID",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:[payload]})}),await emailjs.send("YOUR_EMAILJS_SERVICE","YOUR_EMAILJS_TEMPLATE",Object.fromEntries(fd.entries())),alert("Form submitted successfully!"),window.location.href="index.html"}catch(e){console.error("Submission error:",e),alert("There was an error submitting the form.")}finally{stopSpinner(submitBtn)}}emailjs.init({publicKey:"YOUR_EMAILJS_PUBLIC_KEY"}),prevBtn.addEventListener("click",()=>nextPrev(-1)),nextBtn.addEventListener("click",()=>nextPrev(1)),previewBtn.addEventListener("click",buildPreview),submitBtn.addEventListener("click",e=>{e.preventDefault(),submitForm()}),showStep(currentStep),loadLGAs()});
</script>
